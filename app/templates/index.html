{% extends "base.html" %}

{% block compact_search_form %}
<form action="{{ url_for('search_profile') }}" method="POST">
    <input type="text" name="username" value="{{ users.0.username }}" placeholder="Search username..." required />
    <button type="submit" class="btn btn-primary" style="height:36px;padding:0 14px;">
        <i class="fas fa-search"></i>
    </button>
</form>
{% endblock %}

{% block content %}
{% if not users %}
<!-- ============ LANDING PAGE ============ -->
<section class="hero">
    <h1 class="hero-title">Visualize Your LeetCode Journey</h1>
    <p class="hero-subtitle">
        Analyze your problem-solving stats, contest rankings, and compare profiles â€” all in one beautiful dashboard.
    </p>

    <form action="{{ url_for('search_profile') }}" method="POST" class="hero-form">
        <input type="text" name="username" placeholder="Enter LeetCode username" required />
        <button type="submit" class="btn btn-primary btn-lg">
            <i class="fas fa-chart-bar"></i> Visualize
        </button>
    </form>

    <div class="hero-actions">
        <a href="{{ url_for('comparison_form') }}" class="btn btn-ghost">
            <i class="fas fa-code-compare"></i> Compare Profiles
        </a>
    </div>
</section>

<!-- Features -->
<div class="container">
    <div class="features-grid">
        <div class="card feature-card">
            <div class="feature-icon">
                <i class="fas fa-chart-pie"></i>
            </div>
            <h3>Advanced Charts</h3>
            <p>Interactive difficulty breakdown, language usage, and topic-wise performance at a glance.</p>
        </div>
        <div class="card feature-card">
            <div class="feature-icon" style="background:rgba(6,182,212,0.1);color:#06b6d4;">
                <i class="fas fa-users"></i>
            </div>
            <h3>Profile Comparison</h3>
            <p>Compare LeetCode profiles side-by-side. See who leads in hard problems and contest ratings.</p>
        </div>
        <div class="card feature-card">
            <div class="feature-icon" style="background:rgba(16,185,129,0.1);color:#10b981;">
                <i class="fas fa-trophy"></i>
            </div>
            <h3>Contest Analytics</h3>
            <p>Track your contest rating trajectory, best ranks, and consistency across weekly contests.</p>
        </div>
    </div>
</div>

{% else %}
<!-- ============ PROFILE DASHBOARD ============ -->
<div class="container dashboard">

    <!-- Profile Header -->
    {% for user in users %}
    <div class="profile-header">
        <div class="profile-header-left">
            <img src="{{ user.img }}" alt="{{ user.username }}" class="profile-avatar" />
            <div class="profile-info">
                <h1 class="profile-name">{{ user.realname or user.username }}</h1>
                <span class="profile-username">@{{ user.username }}</span>
                <a href="https://leetcode.com/{{ user.username }}" target="_blank" class="profile-link">
                    View on LeetCode <i class="fas fa-external-link-alt"></i>
                </a>
            </div>
        </div>
        {% if badges and badges|length > 0 %}
        <div class="profile-badges">
            {% for badge in badges %}
            <div class="badge-item" title="{{ badge.hover_text }}">
                <img src="{{ badge.icon_gif if badge.icon_gif else badge.icon }}" alt="{{ badge.name }}" class="badge-icon" loading="lazy">
                <span class="badge-name">{{ badge.name }}</span>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% endfor %}

    <!-- Stat Cards -->
    {% if stat_cards %}
    <p class="section-title">Overview</p>
    <div class="grid grid-cols-4 mb">
        <div class="card stat-card">
            <div class="stat-icon green">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
                <span class="stat-value">{{ stat_cards.total_solved }}</span>
                <span class="stat-label">Total Solved</span>
            </div>
        </div>

        <div class="card stat-card">
            <div class="stat-icon">
                <i class="fas fa-star"></i>
            </div>
            <div class="stat-content">
                <span class="stat-value">{{ stat_cards.contest_rating }}</span>
                <span class="stat-label">Contest Rating</span>
            </div>
        </div>

        <div class="card stat-card">
            <div class="stat-icon amber">
                <i class="fas fa-globe"></i>
            </div>
            <div class="stat-content">
                <span class="stat-value">{{ stat_cards.global_ranking }}</span>
                <span class="stat-label">Global Rank</span>
            </div>
        </div>

        <div class="card stat-card">
            <div class="stat-icon rose">
                <i class="fas fa-percentage"></i>
            </div>
            <div class="stat-content">
                <span class="stat-value">{{ stat_cards.acceptance_rate }}%</span>
                <span class="stat-label">Acceptance Rate</span>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Charts Grid -->
    <p class="section-title">Analytics</p>
    <div class="grid grid-cols-2 mb">
        <!-- Problems Difficulty -->
        <div class="card chart-card">
            <p class="chart-title">Problem Difficulty Breakdown</p>
            <div class="chart-wrapper" id="chart-problems">
                <div class="empty-state"><i class="fas fa-chart-pie"></i><p>No data</p></div>
            </div>
        </div>

        <!-- Language Usage -->
        <div class="card chart-card">
            <p class="chart-title">Submissions by Language</p>
            <div class="chart-wrapper" id="chart-languages">
                <div class="empty-state"><i class="fas fa-code"></i><p>No data</p></div>
            </div>
        </div>
    </div>

    <!-- Contest History (Full Width) -->
    {% if contest_history and contest_history.chart %}
    <div class="card chart-card mb">
        <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;margin-bottom:12px;">
            <p class="chart-title" style="margin:0">Contest Ranking History</p>
            <div class="contest-badges">
                <span class="badge">Attended: {{ contest_history.total }}</span>
                <span class="badge green">Best: {{ contest_history.best }}</span>
                <span class="badge red">Worst: {{ contest_history.worst }}</span>
            </div>
        </div>
        <div class="chart-wrapper" id="chart-contest" style="max-height:360px;">
        </div>
    </div>
    {% endif %}

    <!-- Skills Charts -->
    <div class="grid grid-cols-1 mb" id="skills-charts-container">
        <!-- Rendered by JS -->
    </div>
</div>

<!-- Chart Data -->
<script>
    window.__CHART_DATA__ = {{ chart_data_json|safe }};
</script>
{% endif %}
{% endblock %}